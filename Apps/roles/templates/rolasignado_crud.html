{% load static %}
<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <title>CRUD Roles Asignados</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
  </head>
  <body>
    <div class="container mt-4">
      <h1>Listado de Roles Asignados</h1>
      <button
        class="btn btn-primary"
        data-bs-toggle="modal"
        data-bs-target="#createRolAsignadoModal"
      >
        Asignar Nuevo Rol
      </button>

      <table class="table table-striped mt-3">
        <thead>
          <tr>
            <th>Colaborador</th>
            <th>Rol</th>
            <th>Fecha Inicio</th>
            <th>Fecha Fin</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          {% for ra in roles_asignados %}
          <tr>
            <td>{{ ra.colaborador.nombrecolaborador }}</td>
            <td>{{ ra.rol.nombre }}</td>
            <td>{{ ra.fecha_inicio }}</td>
            <td>{{ ra.fecha_fin }}</td>
            <td>
              <button
                class="btn btn-warning btn-sm"
                data-bs-toggle="modal"
                data-bs-target="#updateRolAsignadoModal{{ ra.id }}"
              >
                Editar
              </button>

              <button
                class="btn btn-danger btn-sm"
                data-bs-toggle="modal"
                data-bs-target="#inactivateRolAsignadoModal{{ ra.id }}"
              >
                Inactivar
              </button>
            </td>
          </tr>

          <!-- Modal Editar -->
          <div
            class="modal fade"
            id="updateRolAsignadoModal{{ ra.id }}"
            tabindex="-1"
            aria-hidden="true"
          >
            <div class="modal-dialog">
              <form method="POST" action="{% url 'rolasignado_update' ra.id %}">
                {% csrf_token %}
                <div class="modal-content">
                  <div class="modal-header">
                    <h5 class="modal-title">Editar Rol Asignado</h5>
                    <button
                      type="button"
                      class="btn-close"
                      data-bs-dismiss="modal"
                      aria-label="Cerrar"
                    ></button>
                  </div>
                  <div class="modal-body">
                    <div class="mb-3">
                      <label class="form-label">Colaborador</label>
                      <!-- Deberías popular el select con tus colaboradores -->
                      <select name="colaborador" class="form-select">
                        <option value="{{ ra.colaborador.id }}">
                            {{ ra.colaborador.codigocolaborador }} - {{ ra.colaborador.nombrecolaborador }}
                        </option>
                        <!-- Agrega más opciones si lo deseas -->
                      </select>
                    </div>
                    <div class="mb-3">
                      <label class="form-label">Rol</label>
                      <select name="rol" class="form-select">
                        <option value="{{ ra.rol.id }}">
                          {{ ra.rol.nombre }} | {{ ra.rol.hora_inicio_semana }} - 
                          {{ ra.rol.hora_fin_semana }} | {{ ra.rol.hora_inicio_sabado }} - 
                          {{ ra.rol.hora_fin_sabado }} | {{ ra.rol.hora_inicio_domingo }} - 
                          {{ ra.rol.hora_fin_domingo }}
                        </option>
                        <!-- Agrega más opciones de roles si deseas -->
                      </select>
                    </div>
                    <div class="mb-3">
                      <label class="form-label">Fecha Inicio</label>
                      <input
                        type="date"
                        name="fecha_inicio"
                        class="form-control"
                        value="{{ ra.fecha_inicio }}"
                      />
                    </div>
                    <div class="mb-3">
                      <label class="form-label">Fecha Fin</label>
                      <input
                        type="date"
                        name="fecha_fin"
                        class="form-control"
                        value="{{ ra.fecha_fin }}"
                      />
                    </div>
                  </div>
                  <div class="modal-footer">
                    <button type="submit" class="btn btn-primary">
                      Guardar
                    </button>
                    <button
                      type="button"
                      class="btn btn-secondary"
                      data-bs-dismiss="modal"
                    >
                      Cancelar
                    </button>
                  </div>
                </div>
              </form>
            </div>
          </div>

          <!-- Modal Inactivar -->
          <div
            class="modal fade"
            id="inactivateRolAsignadoModal{{ ra.id }}"
            tabindex="-1"
            aria-hidden="true"
          >
            <div class="modal-dialog">
              <form
                method="POST"
                action="{% url 'rolasignado_inactivate' ra.id %}"
              >
                {% csrf_token %}
                <div class="modal-content">
                  <div class="modal-header">
                    <h5 class="modal-title">Inactivar Rol Asignado</h5>
                    <button
                      type="button"
                      class="btn-close"
                      data-bs-dismiss="modal"
                      aria-label="Cerrar"
                    ></button>
                  </div>
                  <div class="modal-body">
                    <p>¿Estás seguro de inactivar este rol asignado?</p>
                  </div>
                  <div class="modal-footer">
                    <button type="submit" class="btn btn-danger">
                      Inactivar
                    </button>
                    <button
                      type="button"
                      class="btn btn-secondary"
                      data-bs-dismiss="modal"
                    >
                      Cancelar
                    </button>
                  </div>
                </div>
              </form>
            </div>
          </div>

          {% endfor %}
        </tbody>
      </table>
    </div>

    <!-- Modal Crear Rol Asignado -->
    <div
      class="modal fade"
      id="createRolAsignadoModal"
      tabindex="-1"
      aria-hidden="true"
    >
      <div class="modal-dialog">
        <form method="POST" action="{% url 'rolasignado_create' %}">
          {% csrf_token %}
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title">Asignar Nuevo Rol</h5>
              <button
                type="button"
                class="btn-close"
                data-bs-dismiss="modal"
                aria-label="Cerrar"
              ></button>
            </div>
            <div class="modal-body">
              <div class="mb-3">
                <label class="form-label">Colaborador</label>
                <select name="colaborador" class="form-select" required>
                  {% for colaborador in colaboradores %}
                  <option value="{{ colaborador.id }}">
                    {{ colaborador.codigocolaborador }} - {{ colaborador.nombrecolaborador }}
                  </option>
                  {% endfor %}
                  <!-- Debes listar todos los colaboradores activos -->
                  <!-- <option value="id_colaborador">Nombre Colaborador</option> -->
                </select>
              </div>
              <div class="mb-3">
                <label class="form-label">Rol</label>
                <select name="rol" class="form-select" required>
                  {% for rol in roles %}
                  <option value="{{ rol.id }}">
                    {{ rol.nombre }} | {{ rol.hora_inicio_semana }} - 
                    {{ rol.hora_fin_semana }} | {{ rol.hora_inicio_sabado }} - 
                    {{ rol.hora_fin_sabado }} | {{ rol.hora_inicio_domingo }} - 
                    {{ rol.hora_fin_domingo }}
                  </option>
                  {% endfor %}

                  <!-- Listar roles activos -->
                </select>
              </div>
              <div class="mb-3">
                <label class="form-label">Fecha Inicio</label>
                <input
                  type="date"
                  name="fecha_inicio"
                  class="form-control"
                  required
                />
              </div>
              <div class="mb-3">
                <label class="form-label">Fecha Fin</label>
                <input
                  type="date"
                  name="fecha_fin"
                  class="form-control"
                  required
                />
              </div>
            </div>
            <div class="modal-footer">
              <button type="submit" class="btn btn-primary">Crear</button>
              <button
                type="button"
                class="btn btn-secondary"
                data-bs-dismiss="modal"
              >
                Cerrar
              </button>
            </div>
          </div>
        </form>
      </div>
    </div>

    <script src=" 	https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
